.. _infiniband:

==========
Infiniband
==========

The ``slurmd`` charm have a few actions to manage the Infiniband drivers. A
typical installation has the following steps: first setup the repository to get
the drivers from, then run the install action, and finally reboot the node.

By default, OSD uses the Mellanox repository for OFED 5.3. If you want a
different version, or a different repository, you can create a text file
describing the repository and configure the charms to use it. For example, to
use Mellanox OFED 4.9 for CentOS7, you can download the ``.repo`` file
available `here
<https://linux.mellanox.com/public/repo/mlnx_ofed/4.9-2.2.4.0/rhel7.9/mellanox_mlnx_ofed.repo>`_.
The repository configuration file for Ubuntu is `here
<https://linux.mellanox.com/public/repo/mlnx_ofed/4.9-2.2.4.0/ubuntu20.04/mellanox_mlnx_ofed.list>`_.

With this file saved as ``repository``, you can then configure the charm and
install Infiniband. For example, to install the drivers in a loop to cover all
150 compute nodes:

.. code-blocK:: bash


   for i in {{0..150}}; do
   	juju run-action compute/$i set-infiniband-repo repo="$(cat repository)" --wait
   	juju run-action compute/$i install-infiniband
   done

The charm will install a package named ``mlnx-ofed-all``. Note that this
procedure takes some time. After the drivers are installed, you need to reboot
the nodes.
